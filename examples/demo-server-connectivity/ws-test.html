<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
    <script>  
        window.addEventListener("load", function(evt) {
            var output = document.getElementById("output");
            var ws;

            // Our inputs 
            var words = document.getElementById("words");
            var truth = document.getElementById("truth");
            var wholenumber = document.getElementById("wholenumber");

            // Add content to the end of the output div
            // Add content to the top of the output div
            var printtop = function(message) {
                var d = document.createElement("p");
                d.textContent = message;
                first = output.firstChild;
                output.insertBefore(d, first);
            };
            document.getElementById("open").onclick = function(evt) {
                if (ws) {
                    return false;
                }
                ws = new WebSocket("ws://localhost:8080/sample-game");
                ws.onopen = function(evt) {
                    printtop("OPEN");
                }
                ws.onclose = function(evt) {
                    printtop("CLOSE");
                    ws = null;
                }
                ws.onmessage = function(evt) {
                    // Get the received envelope as structured data
                    env = JSON.parse(evt.data);
                    // If there's a body (base64 encoded) decode it
                    if (env.Body) {
                        env.Body = JSON.parse(atob(env.Body));
                    }
                    printtop("RESPONSE: " + JSON.stringify(env));
                }
                ws.onerror = function(evt) {
                    printtop("ERROR: " + evt.data);
                }
                return false;
            };
            document.getElementById("send").onclick = function(evt) {
                if (!ws) {
                    return false;
                }
                msg = {
                    words: words.value,
                    truth: truth.checked,
                    wholenumber: parseInt(wholenumber.value)

                };
                printtop("SEND: " + JSON.stringify(msg));
                ws.send(JSON.stringify(msg));
                return false;
            };
            document.getElementById("close").onclick = function(evt) {
                if (!ws) {
                    return false;
                }
                ws.close();
                return false;
            };
        });
    </script>
    </head>
    <body>
        <table>
            <tr><td valign="top" width="50%">
                <p>Click "Open" to connect to the server.
                "Send" to send a message to the server.
                "Close" to close the connection. 
                You can change the message and send multiple times.
                </p>
                <p>This code assumes the server is at
                http://localhost:8080</p>
                <form>
                    <button id="open">Open</button>
                    <button id="close">Close</button>
                    <p>
                    {<br/>
                    Words:
                    <input id="words" type="text" value="Hello world!"><br/>
                    Truth
                    <input id="truth" type="checkbox" value="true"><br/>
                    Whole number:
                    <input id="wholenumber" type="text" value="27"><br/>
                    }
                    </p>
                    <button id="send">Send</button>
                </form>
            </td><td valign="top" width="50%">
                <div id="output"></div>
            </td></tr>
        </table>
    </body>
</html>
